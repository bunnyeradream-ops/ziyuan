<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>泰国独立站 · Coming Soon</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/assets/style.css" />
</head>
<body>
  <main class="container">
    <section class="card">
      <div class="brand"><span class="logo">BunnyEra</span></div>
      <h1>泰国独立站</h1>
      <p class="desc">项目已完成仓库隔离与初始化，正在接入云效部署。</p>
      <div class="actions">
        <a class="btn" href="https://github.com/bunnyeradream-ops/ziyuan" target="_blank" rel="noopener">查看仓库</a>
      </div>
      <p class="note">Coming Soon · 云效流水线配置与部署完成后，这里将展示正式站点。</p>
      <hr class="divider" />
      <h2>库存看板</h2>
      <p class="desc">当前为本地演示数据。云端部署后将接入受控数据源。</p>
      <div class="inv-summary">可售合计：<span id="inv-total">-</span></div>
      <div class="table-wrap">
        <table class="table">
          <thead>
            <tr>
              <th>SKU</th>
              <th>名称</th>
              <th>仓位</th>
              <th>总数量</th>
              <th>已占用</th>
              <th>可售</th>
            </tr>
          </thead>
          <tbody id="inv-body"></tbody>
        </table>
      </div>
      <div id="inv-error" class="error"></div>

      <h3 class="chart-title">库存图表（按 SKU 可售）</h3>
      <div id="chart" class="chart"></div>
    </section>
  </main>
  <script>
    (function(){
      var params = new URLSearchParams(location.search);
      var dataUrl = params.get('data') || '/data/inventory.json';
      fetch(dataUrl)
        .then(function(r){ return r.json(); })
        .then(function(data){
          var tbody = document.getElementById('inv-body');
          var totalEl = document.getElementById('inv-total');
          var chart = document.getElementById('chart');
          var sumAvail = 0;
          var maxAvail = 0;
          var rows = (data.items || []).map(function(it){
            var avail = (it.qty || 0) - (it.reserved || 0);
            sumAvail += avail;
            if (avail > maxAvail) maxAvail = avail;
            return { sku: it.sku || '-', name: it.name || '-', location: it.location || '-', qty: it.qty || 0, reserved: it.reserved || 0, avail: avail };
          });
          rows.forEach(function(row){
            var tr = document.createElement('tr');
            tr.innerHTML = '<td>' + row.sku + '</td>' +
                           '<td>' + row.name + '</td>' +
                           '<td>' + row.location + '</td>' +
                           '<td>' + row.qty + '</td>' +
                           '<td>' + row.reserved + '</td>' +
                           '<td>' + row.avail + '</td>';
            tbody.appendChild(tr);
          });
          if (totalEl) totalEl.textContent = sumAvail;
          // 渲染柱状图
          if (chart && maxAvail > 0) {
            rows.forEach(function(row){
              var bar = document.createElement('div');
              bar.className = 'bar';
              var percent = Math.round((row.avail / maxAvail) * 100);
              bar.innerHTML = '<div class="label">' + row.sku + '</div>' +
                              '<div class="meter"><div class="fill" style="width:' + percent + '%"></div></div>' +
                              '<div class="value">' + row.avail + '</div>';
              chart.appendChild(bar);
            });
          }
        })
        .catch(function(err){
          var errEl = document.getElementById('inv-error');
          if (errEl) errEl.textContent = '数据未配置或加载失败';
          console.error('inventory load error', err);
        });
    })();
  </script>
</body>
</html>